#!/usr/bin/with-contenv bash
. /usr/local/bin/variables

s6-svwait -u /var/run/s6/services/plex

export PYTHONPATH=/opt/plex_autoscan

USER=$(if getent passwd plex > /dev/null; then echo "plex"; else echo "abc"; fi)

exec s6-setuidgid $USER \
    /opt/plex_autoscan/venv/bin/python -m autoscan server \
        --config "$PLEX_AUTOSCAN_CONFIG" \
        --queuefile "$(dirname "$PLEX_AUTOSCAN_CONFIG")/queue.db" \
        --cachefile "$(dirname "$PLEX_AUTOSCAN_CONFIG")/cache.db"
